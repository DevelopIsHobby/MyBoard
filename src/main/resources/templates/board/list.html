<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ListPage</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        body {
            padding-top : 80px;
        }
    </style>
</head>
<body>
    <div class="navbar navbar-dark bg-dark fixed-top navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand" href="#">Bootstrap</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-content">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbar-content">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">HTML</a>
                        <div class="dropdown-menu">
                            <a href="#" class="dropdown-item">Geolocation</a>
                            <a href="#" class="dropdown-item">Drag and Drop</a>
                            <div class="dropdown-divider"></div>
                            <a href="#" class="dropdown-item">Motion</a>
                        </div>
                    </li>
                    <li class="nav-item"><a href="#" class="nav-link">CSS3</a></li>
                    <li class="nav-item"><a href="#" class="nav-link">ECMAScript</a></li>
                    <li class="nav-item"><a href="#" class="nav-link">Node.js</a></li>
                    <li class="nav-item"><a href="#" class="nav-link">API</a></li>
                </ul>
                <form action="" class="form-inline">
                    <input type="text" class="form-control" placeholder="Search"/>
                </form>
                <ul class="navbar-nav">
                    <li class="nav-item"><a href="#" class="nav-link">Node.js</a></li>
                    <li class="nav-item"><a href="#" class="nav-link">API</a></li>
                </ul>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="row">
            <div class="mt-2 p-5 bg-secondary text-white rounded">
                <h1>Board List Page</h1>
                <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. </p>
                <a href="#" class="btn btn-primary btn-lg">Register</a>
            </div>


            <div class="row row-cols-1 row-cols-md-3 g-3 list">
                <div class="row" id="boardList"></div>
                <div class="scrollerFooter"></div>

                <tbody id="sentinel">
                <tr th:each="dto:${result.dtoList}" class="mb-3">
                    <div class="col">
                        <div class="card h-70">
                            <img th:src="|/display?fileName=${dto.imageDTO.getThumbnailURL()}|" style="max-height: 18rem;" class="card-img-top" alt="...">
                            <div class="card-body">
                                <div class="row mb-2">
                                    <div class="col-9">
                                        <h4 class="card-title">[[${dto.title}]]<span><small><b> ([[${dto.replyCount}]])</b></small></span></h4>
                                    </div>
                                    <p class="card-text">[[${dto.writerEmail}]]</p>
                                </div>

                                <span th:each="tag:${dto.tags}" class="card-text"><small>#[[${tag}]]   </small></span>
                                <p class="card-text">Like : <b>[[${dto.likeCount}]]</b></p>

                            </div>
                            <div class="card-footer">
                                <small th:if="${dto.regDate != dto.modDate}" class="text-body-secondary">[[${#temporals.format(dto.modDate,'yyyy/MM/dd')}]]</small>
                                <small th:if="${dto.regDate == dto.modDate}" class="text-body-secondary">[[${#temporals.format(dto.regDate,'yyyy/MM/dd')}]]</small>
                            </div>
                        </div>
                    </div> <!--게시글 하나 끝-->
                </tr>
                    <!--  Pagination-->
<!--                    <ul class="pagination mt-4 h-1 justify-content-center align-items-center">-->
<!--                        <li class="page-item" th:if="${result.prev}">-->
<!--                            <a th:href="@{/board/list(page=${result.start -1})}" class="page-link" tabindex="-1">Previous</a>-->
<!--                        </li>-->

<!--                        <li th:class=" 'page-item' + ${result.page == page? 'active' : ''}" th:each="page: ${result.pageList}">-->
<!--                            <a th:href="@{/board/list(page=${page})}" class="page-link">[[${page}]]</a>-->
<!--                        </li>-->

<!--                        <li class="page-item" th:if="${result.next}">-->
<!--                            <a th:href="@{/board/list(page=${result.end + 1})}" class="page-link" tabindex="-1">Next</a>-->
<!--                        </li>-->
<!--                    </ul>-->
                    <!--  Pagination 끝-->
                </tbody>

            </div>
        </div>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script>
            document.addEventListener("DOMContentLoaded", function() {
                let page = 0;
                let isLoading = false;

                function loadItems() {
                    if (isLoading) return;
                    isLoading = true;

                    fetch(`/board/list?page=${page}`)
                        .then(response => response.json())
                        .then(data => {
                            const boardList = document.getElementById("boardList");
                            data.dtoList.forEach(item => {
                                const div = document.createElement("div");
                                div.className = "col-12 mb-3";
                                div.innerHTML = `
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">${item.title}</h5>
                                <p class="card-text">${item.content}</p>
                                <p class="card-text"><small class="text-muted">${item.writerEmail}</small></p>
                            </div>
                        </div>
                    `;
                                boardList.appendChild(div);
                            });

                            if (data.page < data.totalPage - 1) {
                                page++;
                                isLoading = false;
                            } else {
                                const scrollerFooter = document.querySelector('.scrollerFooter');
                                scrollerFooter.innerHTML = "<p>No more data</p>";
                            }
                        });
                }

                const observer = new IntersectionObserver(entries => {
                    if (entries[0].intersectionRatio <= 0) return;
                    loadItems();
                });

                observer.observe(document.querySelector('.scrollerFooter'));

                loadItems(); // Initial load
            });

        </script>




</body>
</html>