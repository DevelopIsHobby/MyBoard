<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ListPage</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        body {
            padding-top : 80px;
        }
    </style>
</head>
<body>
    <div class="navbar navbar-dark bg-dark fixed-top navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand" href="#">Bootstrap</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-content">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbar-content">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">HTML</a>
                        <div class="dropdown-menu">
                            <a href="#" class="dropdown-item">Geolocation</a>
                            <a href="#" class="dropdown-item">Drag and Drop</a>
                            <div class="dropdown-divider"></div>
                            <a href="#" class="dropdown-item">Motion</a>
                        </div>
                    </li>
                    <li class="nav-item"><a href="#" class="nav-link">CSS3</a></li>
                    <li class="nav-item"><a href="#" class="nav-link">ECMAScript</a></li>
                    <li class="nav-item"><a href="#" class="nav-link">Node.js</a></li>
                    <li class="nav-item"><a href="#" class="nav-link">API</a></li>
                </ul>
                <form action="" class="form-inline">
                    <input type="text" class="form-control" placeholder="Search"/>
                </form>
                <ul class="navbar-nav">
                    <li class="nav-item"><a href="#" class="nav-link">Node.js</a></li>
                    <li class="nav-item"><a href="#" class="nav-link">API</a></li>
                </ul>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="row">
            <div class="mt-2 p-5 bg-secondary text-white rounded">
                <h1>Board List Page</h1>
                <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. </p>
                <a href="#" class="btn btn-primary btn-lg">Register</a>
            </div>


            <div id="content-container">

            </div>

        </div>

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script>
            let currentPage = 1;
            const pageSize = 10; // 한 번에 가져올 데이터의 개수
            const totalPage =
            $(document).ready(function() {
                loadMoreData(currentPage, pageSize); // 페이지 로드 시 초기 데이터 로드

                $(window).scroll(function() {
                    if ($(window).scrollTop() + $(window).height() >= $(document).height() - 20) {
                        currentPage++;
                        console.log(currentPage)
                        loadMoreData(currentPage, pageSize);
                    }
                });
            });

            function loadMoreData(page, size) {
                $.ajax({
                    url: '/api/data',
                    method: 'GET',
                    data: { page: page, size: size },
                    success: function(data) {
                        console.log("Data fetched",data);
                        updateContent(data.dtoList); // Page 객체의 content 리스트를 사용
                    },
                    error: function(error) {
                        console.error("Error fetching data", error);
                    }
                });
            }

            function updateContent(data) {
                let content = '<div class="row row-cols-1 row-cols-md-3 g-3 list">';
                data.forEach(dto => {
                    console.log(dto);
                    content += '<div class="col">'
                    content += '<div class="card h-70">'
                    content += '<img src="/display?fileName=' + dto.imageDTO.thumbnailURL + '" style="max-height: 18rem;" class="card-img-top" alt="...">'
                    content += '<div class="card-body">'
                    content += '<div class="row mb-2">'
                    content += '<div class="col-9">'
                    content += '<h4 class="card-title">' + dto.title + '<span><small><b> (' + dto.replyCount + ')</b></small></span></h4>'
                    content += '</div>'
                    content += '<p class="card-text">' + dto.writerEmail + '</p></div>'
                    dto.tags.forEach(tag => {
                        content += '<span class="card-text"><small>#' + tag + '   </small></span>'
                    });
                    content += '<p class="card-text">Like : <b>' + dto.likeCount + '</b></p></div>'
                    content += '<div class="card-footer">'
                    content += '<small>' + (dto.regDate != dto.modDate ? dto.modDate : dto.regDate) + '</small>'
                    content += '</div></div></div>'
                });
                content += '</div>'
                $('#content-container').append(content); // 새 콘텐츠를 기존 콘텐츠에 추가
            }

        </script>


</body>
</html>